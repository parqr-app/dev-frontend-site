"use strict";(self.webpackChunkpar_qr_app=self.webpackChunkpar_qr_app||[]).push([[797],{5766:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var i=n(7294),a=n(3964),s=n.n(a),r=n(4170),o=n(7326),m=n(1721),c=n(5360),l=n(8922);function p(e,t,n,i,a,s,r){try{var o=e[s](r),m=o.value}catch(c){return void n(c)}o.done?t(m):Promise.resolve(m).then(i,a)}var u=n(7757),d=n.n(u),h="https://backend.demo.parqr.app:8443/graphql/",f={style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}};function E(){return i.createElement("label",null,"Card Details",i.createElement(c.CardElement,{options:f}))}function g(e){var t=(0,c.useStripe)(),n=(0,c.useElements)(),a=function(){var i,a=(i=d().mark((function i(a){var s,r,o,m;return d().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a.preventDefault(),t&&n){i.next=3;break}return i.abrupt("return");case 3:return s="mutation completePayment($transactionId: String!){\n            completePayment(input: {transactionId: $transactionId}) {\n                success\n                message\n            }\n        }",r="",o=fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:"mutation startPayment($amount: Int!, $spotName: ID!, $lotName: ID!){\n            startPayment(input: {amount: $amount, spot: {spotName: $spotName, lotName: $lotName}} ) {\n                success\n                message\n                secret\n            }\n        }",variables:{amount:Math.round(e.amount),spotName:e.spotName,lotName:e.lotName}})}).then((function(e){return e.json()})).then((function(e){var t=e.data.startPayment;1==t.success?r=t.secret:console.log(t.message)})),i.next=9,o;case 9:if(console.log(r),""!==r){i.next=12;break}return i.abrupt("return");case 12:return i.next=14,t.confirmCardPayment(r,{payment_method:{card:n.getElement(c.CardElement)}});case 14:(m=i.sent).error?console.log(m.error.message):"succeeded"===m.paymentIntent.status&&(console.log("Payment Success"),fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:s,variables:{transactionId:m.paymentIntent.id}})}).then((function(e){return e.json()})).then((function(t){var n=t.data.completePayment;1==n.success?(console.log("Lot time update success"),e.onPayment()):console.log(n.message)})));case 16:case"end":return i.stop()}}),i)})),function(){var e=this,t=arguments;return new Promise((function(n,a){var s=i.apply(e,t);function r(e){p(s,n,a,r,o,"next",e)}function o(e){p(s,n,a,r,o,"throw",e)}r(void 0)}))});return function(e){return a.apply(this,arguments)}}();return i.createElement("form",{onSubmit:a},i.createElement(E,null),i.createElement("button",{disabled:!t},"Confirm Payment"))}var N=(0,l.J)("pk_test_51JZT7fLBm4Ihz0NC9q5UNwoiPHEXAVSI1BqpVSOmlKgiquacCqKcpEV888D0RJU88AjGzO0lP9tC7lOKfInIVOQE00vFS4dAz5"),y=function(e){function t(t){var n;return(n=e.call(this,t)||this).resetState=n.resetState.bind((0,o.Z)(n)),n.confirm=n.confirm.bind((0,o.Z)(n)),n.incrementTime=n.incrementTime.bind((0,o.Z)(n)),n.decrementTime=n.decrementTime.bind((0,o.Z)(n)),n.onUpdate=n.props.onUpdate.bind((0,o.Z)(n)),n.state={totalCost:0,newExpiry:n.props.expiry.clone(),additionalDuration:s().duration(0),decrementButton:i.createElement("button",{disabled:!0},"-"),incrementButton:i.createElement("button",{onClick:n.incrementTime},"+"),paying:!1},n.priceIncrement=Math.round(n.props.rate*(n.props.addTime.asMinutes()/60)),n}(0,m.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return s().duration(e.expiry.diff(s()()))>0&&t.additionalDuration<=0?{newExpiry:e.expiry.clone()}:s().duration(t.newExpiry.diff(s()()))<0?{newExpiry:s()()}:null};var n=t.prototype;return n.componentDidUpdate=function(){this.priceIncrement=Math.round(this.props.rate*(this.props.addTime.asMinutes()/60))},n.resetState=function(){this.onUpdate(),this.setState({totalCost:0,newExpiry:this.props.expiry,additionalDuration:s().duration(0),decrementButton:i.createElement("button",{disabled:!0},"-"),incrementButton:i.createElement("button",{onClick:this.incrementTime},"+"),paying:!1})},n.incrementTime=function(){this.setState({totalCost:this.state.totalCost+this.priceIncrement,newExpiry:this.state.newExpiry.clone().add(this.props.addTime),additionalDuration:this.state.additionalDuration.add(this.props.addTime),decrementButton:i.createElement("button",{onClick:this.decrementTime},"-")}),s().duration(this.state.newExpiry.diff(s()())).asMinutes()>=360&&this.setState({incrementButton:i.createElement("button",{disabled:!0},"+")})},n.decrementTime=function(){this.state.additionalDuration.asMinutes()>0&&this.setState({totalCost:this.state.totalCost-this.priceIncrement,newExpiry:this.state.newExpiry.subtract(this.props.addTime),additionalDuration:this.state.additionalDuration.subtract(this.props.addTime),incrementButton:i.createElement("button",{onClick:this.incrementTime},"+")}),this.state.additionalDuration.asMinutes()<=0&&this.setState({decrementButton:i.createElement("button",{disabled:!0},"-")})},n.confirm=function(){this.setState({paying:!0})},n.render=function(){return this.state.paying?i.createElement(c.Elements,{stripe:N},i.createElement(g,{amount:this.state.totalCost,spotName:this.props.spotName,lotName:this.props.lotName,onPayment:this.resetState})):i.createElement("div",null,i.createElement("section",{className:"add-time"},i.createElement("div",{className:"container"},i.createElement("div",{className:"incrementor"},i.createElement("div",{className:"subtract-button"},this.state.decrementButton),i.createElement("div",{className:"subtotal"},i.createElement("div",{className:"countdown-display"},i.createElement("span",null,this.state.additionalDuration.asMinutes()," minutes")),i.createElement("div",{className:"expiry-display"},i.createElement("span",null,"Expires ",this.state.newExpiry.format("HH:mm")))),i.createElement("div",{className:"add-button"},this.state.incrementButton)),i.createElement("div",{className:"confirm-button"},i.createElement("button",{onClick:this.confirm},i.createElement("div",{className:"confirm-price"},"$",this.state.totalCost/100),i.createElement("div",{className:"confirm-message"},"Tap to Confirm"))))))},t}(i.Component),v=function(e){function t(t){var n;return(n=e.call(this,t)||this).tick=n.tick.bind((0,o.Z)(n)),n.state={remainingTime:s().duration(n.props.expiry.diff(s()()))},n}(0,m.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return{remainingTime:s().duration(e.expiry.diff(s()()))}};var n=t.prototype;return n.componentDidMount=function(){var e=this;this.timerID=setInterval((function(){return e.tick()}),1e3)},n.componentWillUnmount=function(){clearInterval(this.timerID)},n.tick=function(){this.state.remainingTime>0&&this.setState({remainingTime:s().duration(this.props.expiry.diff(s()()))})},n.getHourString=function(){return this.state.remainingTime.get("hours")<10?"0"+this.state.remainingTime.get("hours"):this.state.remainingTime.get("hours")},n.getMinuteString=function(){return this.state.remainingTime.get("minutes")<10?"0"+this.state.remainingTime.get("minutes"):this.state.remainingTime.get("minutes")},n.getSecondString=function(){return this.state.remainingTime.get("seconds")<10?"0"+this.state.remainingTime.get("seconds"):this.state.remainingTime.get("seconds")},n.strSpace=function(e){return Array(e).fill("Â ").join("")},n.render=function(){return this.state.remainingTime>0?i.createElement("section",{className:"parking-meter"},i.createElement("div",{className:"container"},i.createElement("div",{className:"remaining-time"},"Time Remaining"),i.createElement("div",{className:"remaining-time-countdown"},this.getHourString()," ",this.strSpace(2)," ",this.getMinuteString()," ",this.strSpace(2),"  ",this.getSecondString()),i.createElement("div",{className:"hr-min-s"},this.strSpace(2)," hours ",this.strSpace(14)," minutes ",this.strSpace(11)," seconds",this.strSpace(1)),i.createElement("div",{className:"remaining-time-expiry"},"Expires ",this.props.expiry.format("HH:mm")),i.createElement("div",{className:"spot-info"},i.createElement("div",{className:"lot-id"},"Lot ID: ",this.props.lotName),i.createElement("div",{className:"spot-id"},"Spot ID: ",this.props.spotName)))):i.createElement("section",{className:"parking-meter"},i.createElement("div",{className:"container"},i.createElement("div",{className:"remaining-time-expired"},"Time Remaining"),i.createElement("div",{className:"remaining-time-countdown-expired"},"00"," ",this.strSpace(2)," ","00"," ",this.strSpace(2),"  ","00"),i.createElement("div",{className:"hr-min-s-expired"},this.strSpace(2)," hours ",this.strSpace(14)," minutes ",this.strSpace(11)," seconds",this.strSpace(1)),i.createElement("div",{className:"remaining-time-expiry-expired"},"EXPIRED"),i.createElement("div",{className:"spot-info"},i.createElement("div",{className:"lot-id"},"Lot ID: ",this.props.lotName),i.createElement("div",{className:"spot-id"},"Spot ID: ",this.props.spotName))))},t}(i.Component),S=(0,l.J)("pk_test_51JZT7fLBm4Ihz0NC9q5UNwoiPHEXAVSI1BqpVSOmlKgiquacCqKcpEV888D0RJU88AjGzO0lP9tC7lOKfInIVOQE00vFS4dAz5"),b=function(e){var t=e.params,n=t.lotName,a=t.spotName,o=(0,i.useState)(s().duration(0)),m=o[0],l=o[1],p=(0,i.useState)(0),u=p[0],d=p[1],h=(0,i.useState)(s()()),f=h[0],E=h[1],g=(0,i.useState)(s()()),N=g[0],b=g[1];return(0,i.useEffect)((function(){return fetch("https://backend.demo.parqr.app:8443/graphql/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:"query spotQuery($lotName: ID!, $spotName: ID!) {\n        spot(input: {lotName: $lotName, spotName: $spotName}) {\n            endTime\n            lot {\n                rate\n                timeUnit\n                minCost\n            }\n        }\n    }",variables:{lotName:n,spotName:a}})}).then((function(e){return e.json()})).then((function(e){d(e.data.spot.lot.rate),l(s().duration(e.data.spot.lot.timeUnit,"minutes")),b(s()(e.data.spot.endTime))}))}),[f]),i.createElement(c.Elements,{stripe:S},i.createElement(r.h,null),i.createElement(v,{lotName:e.lotName,spotName:e.spotName,expiry:N}),i.createElement(y,{lotName:e.lotName,spotName:e.spotName,rate:u,addTime:m,expiry:N,onUpdate:function(){E(s()())}}))}},7326:function(e,t,n){function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return i}})}}]);
//# sourceMappingURL=component---src-pages-meter-lot-lot-name-spot-spot-name-index-js-9019c646df3dafa8f6ba.js.map